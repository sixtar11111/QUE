<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>链接漂流瓶</title>
    <style>
        body {
            font-family: sans-serif;
            text-align: center;
            padding: 50px;
            background: #f0f2f5;
        }

        .box {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-width: 500px;
            margin: 0 auto;
        }

        input {
            padding: 10px;
            width: 70%;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        button {
            padding: 10px 20px;
            background: #0052d9;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

            button:hover {
                background: #003bb3;
            }

        #result {
            margin-top: 20px;
            padding: 15px;
            background: #e8f4ff;
            border-radius: 5px;
            display: none;
        }

        a {
            color: #0052d9;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="box">
        <h1>🔗 链接交换</h1>
        <p>输入你的链接，随机交换一个别人的链接。</p>

        <input type="url" id="myUrl" placeholder="https://example.com">
        <button onclick="exchange()">交换</button>

        <div id="result"></div>
    </div>

    <script>
        async function exchange() {
            const input = document.getElementById('myUrl');
            const resultDiv = document.getElementById('result');
            const url = input.value;

            if (!url) return alert("请先输入网址");

            resultDiv.style.display = 'block';
            resultDiv.innerText = "正在交换中...";

            try {
                // 1. 上传
                const upRes = await fetch('/upload', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ url: url })
                });
                if (!upRes.ok) throw new Error("上传失败");

                // 2. 获取
                const getRes = await fetch('/random');
                const data = await getRes.json();

                if (data.link) {
                    resultDiv.innerHTML = `交换成功！去看看这个：<br><br><a href="${data.link}" target="_blank">${data.link}</a>`;
                } else {
                    resultDiv.innerText = "你是第一个上传的人！暂时没有别人的链接。";
                }

                input.value = ''; // 清空输入框

            } catch (e) {
                resultDiv.innerText = "出错了，请稍后再试。";
                console.error(e);
            }
        }
    </script>
</body>

</html>
